<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>My Study OS</title>

  <link rel="manifest" href="/My-Study-OS/manifest.json">
  <meta name="theme-color" content="#ffffff">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #02081b;
      --bg-card: #020617;
      --border-subtle: rgba(51,65,85,0.9);
      --accent: #4f46e5;
      --accent-soft: rgba(79,70,229,0.16);
      --accent-strong: #6366f1;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --success: #22c55e;
      --warning: #facc15;
    }

    .theme-light {
      --bg: #e5e7eb;
      --bg-soft: #f3f4f6;
      --bg-card: #ffffff;
      --border-subtle: rgba(148,163,184,0.8);
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,0.12);
      --accent-strong: #1d4ed8;
      --text: #111827;
      --text-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #0b1120 0, var(--bg) 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
      transition: background 0.25s ease;
    }

    body.theme-light {
      background: linear-gradient(135deg, #e5e7eb, #ffffff);
    }

    .app {
      width: 100%;
      max-width: 980px;
      background: linear-gradient(135deg, var(--bg-soft), var(--bg-card));
      border-radius: 22px;
      padding: 18px 18px 26px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.5);
      border: 1px solid rgba(148,163,184,0.35);
      position: relative;
      overflow: hidden;
      transition: background 0.25s ease, box-shadow 0.25s ease, border 0.25s ease;
    }

    .theme-light .app {
      box-shadow: 0 14px 30px rgba(148,163,184,0.4);
      border-color: rgba(148,163,184,0.6);
    }

    .logo {
      display: inline-flex;
      align-items: baseline;
      gap: 0.35rem;
      font-weight: 700;
      letter-spacing: 0.08em;
    }

    .logo-main {
      font-size: 1.05rem;
    }

    .logo-pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--accent-strong);
      text-transform: uppercase;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 10px;
    }

    #app-title {
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    #today-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    #theme-toggle {
      border-radius: 999px;
      padding: 6px 10px;
      background: var(--bg-soft);
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text-muted);
      font-size: 0.78rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    #theme-toggle span {
      font-size: 0.9rem;
    }

    nav {
      display: flex;
      gap: 6px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .nav-btn {
      border-radius: 999px;
      padding: 7px 12px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      color: var(--text-muted);
      font-size: 0.78rem;
      cursor: pointer;
      transition: 0.16s ease;
    }

    .nav-btn.active {
      background: var(--accent-soft);
      color: var(--accent-strong);
      border-color: var(--accent-strong);
    }

    main {
      margin-top: 4px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .grid-two {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 12px;
    }

    @media (max-width: 780px) {
      .grid-two {
        grid-template-columns: 1fr;
      }
      body {
        padding: 10px;
      }
      .app {
        padding: 14px 12px 20px;
        border-radius: 18px;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
      transition: background 0.2s ease, border 0.2s ease;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .card-title {
      font-size: 0.96rem;
      font-weight: 600;
    }

    .pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.66);
      color: var(--text-muted);
      white-space: nowrap;
      background: var(--bg-soft);
    }

    .input-row {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .goal-date-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .goal-date-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 80px;
      font-size: 0.75rem;
    }

    .goal-date-group label {
      color: var(--text-muted);
      font-size: 0.72rem;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 9px;
      border: 1px solid rgba(75,85,99,0.9);
      background: var(--bg-soft);
      color: var(--text);
      font-size: 0.82rem;
    }

    input:focus,
    select:focus {
      outline: 1px solid var(--accent-strong);
      border-color: var(--accent-strong);
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 10px;
      padding: 6px 10px;
      font-size: 0.78rem;
      font-weight: 500;
      background: var(--accent);
      color: white;
      transition: transform 0.05s ease, box-shadow 0.16s ease,
        background 0.16s ease;
      white-space: nowrap;

      -webkit-appearance: none;
      appearance: none;
      line-height: 1;
    }

    button:hover {
      background: var(--accent-strong);
      box-shadow: 0 6px 14px rgba(79,70,229,0.45);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    button.secondary {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(75,85,99,0.9);
      box-shadow: none;
    }

    button.secondary:hover {
      background: var(--bg-soft);
    }

    button.danger {
      background: #b91c1c;
    }

    button.danger:hover {
      background: #dc2626;
      box-shadow: 0 6px 14px rgba(220,38,38,0.45);
    }

    ul {
      list-style: none;
    }

    /* HOME */
    #dday-value {
      font-size: 1.3rem;
      font-weight: 700;
      margin-top: 4px;
    }

    #dday-label {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    #dday-target-text {
      font-size: 0.88rem;
    }

    #goals-list {
      max-height: 130px;
      overflow-y: auto;
      padding-right: 3px;
      margin-top: 4px;
    }

    .goal-item {
      font-size: 0.83rem;
      padding: 4px 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(31,41,55,0.2);
    }

    .goal-text {
      flex: 1;
      margin-right: 4px;
    }

    #home-summary {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.5;
    }

    /* TODOS */
    #todo-scope-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .scope-tab {
      font-size: 0.76rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: var(--bg-soft);
      color: var(--text-muted);
      cursor: pointer;
    }

    .scope-tab.active {
      background: var(--accent-soft);
      color: var(--accent-strong);
      border-color: var(--accent-strong);
    }

    #todo-list {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
      border-top: 1px solid rgba(31,41,55,0.2);
    }

    .todo-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 2px;
      border-bottom: 1px solid rgba(31,41,55,0.2);
      gap: 6px;
    }

    .todo-left {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
    }

    .status-btn {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1px solid rgba(75,85,99,0.9);
      background: var(--bg-soft);
      color: var(--text-muted);
      font-size: 0.82rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .status-btn.success {
      border-color: var(--success);
      color: var(--success);
    }

    .status-btn.partial {
      border-color: var(--warning);
      color: var(--warning);
    }

    .status-btn.fail {
      border-color: var(--danger);
      color: var(--danger);
    }

    .todo-text {
      font-size: 0.87rem;
      word-break: break-word;
    }

    .todo-meta {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .todo-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .tiny {
      font-size: 0.72rem;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      color: var(--text-muted);
      background: transparent;
      white-space: nowrap;
      cursor: pointer;
    }

    /* POMODORO */
    #pomo-display {
      font-size: 2.1rem;
      font-weight: 700;
      text-align: center;
      margin: 6px 0 4px;
    }

    #pomo-phase {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    #pomo-controls {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    #pomo-progress-text {
      text-align: center;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    #pomo-config-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
      margin-top: 6px;
    }

    .config-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.78rem;
    }

    .config-item label {
      color: var(--text-muted);
    }

    /* STUDY TIMER */
    #study-time-today {
      font-size: 1.3rem;
      font-weight: 700;
      margin: 4px 0;
    }

    #study-status {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    #study-controls {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    #study-log {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* FOCUS MODE */
    #focus-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.96);
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    #focus-overlay-inner {
      max-width: 480px;
      width: 100%;
      background: #020617;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.7);
      padding: 18px 16px 16px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.7);
    }

    #focus-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    #focus-subtitle {
      font-size: 0.88rem;
      color: #cbd5f5;
      margin-bottom: 10px;
    }

    #focus-hint {
      font-size: 0.76rem;
      color: #9ca3af;
      margin-top: 8px;
    }

    #focus-timer-label {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    /* CALENDAR */
    #calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      margin-top: 8px;
      font-size: 0.8rem;
    }

    .calendar-weekday {
      text-align: center;
      padding: 4px 0;
      color: var(--text-muted);
      border-bottom: 1px solid rgba(31,41,55,0.2);
    }

    .calendar-day {
      min-height: 38px;
      border-radius: 8px;
      border: 1px solid rgba(31,41,55,0.3);
      padding: 3px 4px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: var(--bg-soft);
    }

    .calendar-day.other-month {
      opacity: 0.35;
    }

    .calendar-day-number {
      font-size: 0.8rem;
    }

    .calendar-day-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
      margin-top: 2px;
      align-self: flex-start;
    }

    .calendar-day.selected {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    #calendar-month-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.88rem;
      margin-bottom: 4px;
    }

    #calendar-month-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    #calendar-month-picker {
      padding: 2px 6px;
      font-size: 0.8rem;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: var(--bg-soft);
      color: var(--text);
    }

    #calendar-selected-date {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    #calendar-task-list {
      margin-top: 6px;
      max-height: 150px;
      overflow-y: auto;
      padding-right: 3px;
      font-size: 0.82rem;
    }

    .calendar-task-item {
      border-bottom: 1px solid rgba(31,41,55,0.2);
      padding: 4px 2px;
    }

    .calendar-task-scope {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* SMALL TEXTS */
    .hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .tagline {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    #todo-add-btn {
        margin-left: auto;
        margin-top: 20px;
        padding: 0 14px;
        height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

  </style>
</head>
<body class="theme-dark">
  <div id="focus-overlay">
    <div id="focus-overlay-inner">
      <div id="focus-title">ì§€ê¸ˆì€ ì§‘ì¤‘ ëª¨ë“œ</div>
      <div id="focus-subtitle">
        ì´ ì‹œê°„ë§Œí¼ì€ ë‹¤ë¥¸ ì•±/ì‚¬ì´íŠ¸ ìƒê° ë§ê³ ,<br />ëˆˆì•ì˜ ê³µë¶€ì—ë§Œ ì§‘ì¤‘í•´ë´ìš”.
      </div>
      <div id="focus-timer-label">--:--</div>
      <div class="hint">
        * ì›¹ì‚¬ì´íŠ¸ëŠ” ì‹¤ì œë¡œ ë‹¤ë¥¸ ì•±ì„ ë§‰ì„ ìˆ˜ ì—†ì–´ìš”.<br />
        ëŒ€ì‹ , ì´ í™”ë©´ì„ ë³´ë©´ì„œ ë³¸ì¸ì´ ìŠ¤ìŠ¤ë¡œ ì•½ì†ì„ ì§€í‚¤ëŠ” ìš©ë„ì˜ â€œì†Œí”„íŠ¸ ì°¨ë‹¨â€ì…ë‹ˆë‹¤.
      </div>
      <button id="focus-exit-btn" style="margin-top:12px;">ì§‘ì¤‘ ëª¨ë“œ ì¢…ë£Œ</button>
      <div id="focus-hint">ì´ ì°½ì€ ì–¸ì œë“ ì§€ ë‹«ì„ ìˆ˜ ìˆì§€ë§Œ,<br />ê°€ëŠ¥í•˜ë©´ ê³µë¶€ ì‹œê°„ ë™ì•ˆ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ ë³´ì!</div>
    </div>
  </div>

  <div class="app">
    <header>
      <div>
        <div class="logo">
          <span class="logo-main">My Study</span>
          <span class="logo-pill">OS</span>
        </div>
        <div id="today-label"></div>
      </div>
      <button id="theme-toggle">
        <span id="theme-icon">ğŸŒ™</span>
        <span id="theme-text">ë‹¤í¬ ëª¨ë“œ</span>
      </button>
    </header>

    <nav>
      <button class="nav-btn active" data-section="home">í™ˆ</button>
      <button class="nav-btn" data-section="todos">ê³„íš(To-do)</button>
      <button class="nav-btn" data-section="calendar">ë‹¬ë ¥</button>
      <button class="nav-btn" data-section="pomodoro">í¬ëª¨ë„ë¡œ</button>
      <button class="nav-btn" data-section="study">ê³µë¶€ íƒ€ì´ë¨¸</button>
      <button class="nav-btn" data-section="settings">ì„¤ì •</button>
    </nav>

    <main>
      <!-- HOME -->
      <section id="home" class="section active">
        <div class="grid-two">
          <div class="card">
            <div class="card-header">
              <div class="card-title">D-Day & ëª©í‘œ</div>
              <span class="pill">Home</span>
            </div>
            <div id="dday-label">ëª©í‘œ ë‚ ì§œì™€ ì œëª©ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”.</div>
            <div id="dday-value">D-0</div>
            <div id="dday-target-text" style="margin-top:2px;"></div>

            <div class="input-row" style="margin-top:10px;">
              <input type="text" id="dday-title-input" placeholder="ì˜ˆ: ê³¼í•™ê³  ì…ì‹œ" />
              <input type="date" id="dday-date-input" />
            </div>
            <button id="dday-save-btn">D-Day ì €ì¥</button>
            <button id="dday-clear-btn" class="secondary" style="margin-left:4px;">ì´ˆê¸°í™”</button>

            <div class="hint">
              * D-DayëŠ” ì´ ê¸°ê¸°(ë¸Œë¼ìš°ì €)ì—ë§Œ ì €ì¥ë¼ìš”. GitHub ì„œë²„ì—ëŠ” ê¸°ë¡ë˜ì§€ ì•Šì•„ìš”.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">ì˜¤ëŠ˜ì˜ ëª©í‘œ</div>
              <span class="pill">Goals</span>
            </div>
            <div class="input-row">
              <input type="text" id="goal-input" placeholder="ì˜¤ëŠ˜ ê¼­ ì´ë£¨ê³  ì‹¶ì€ ëª©í‘œë¥¼ ì ì–´ë³´ì„¸ìš”." />
              <button id="goal-add-btn">ì¶”ê°€</button>
            </div>
            <ul id="goals-list"></ul>
            <button id="goals-clear-btn" class="secondary" style="margin-top:6px;">ì „ì²´ ì‚­ì œ</button>

            <div id="home-summary">
              Â· ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„: <span id="summary-study-time">00:00:00</span><br />
              Â· ì˜¤ëŠ˜ ì™„ë£Œí•œ í•  ì¼(ëª¨ë“  ê¸°ê°„ í•©ì‚°): <span id="summary-done-count">0</span> ê°œ
            </div>
          </div>
        </div>
      </section>

      <!-- TODOS -->
      <section id="todos" class="section">
        <div class="card">
          <div class="card-header">
            <div class="card-title">ê³„íš & ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
            <span class="pill">ì—° / ì›” / ì£¼ / ì¼</span>
          </div>

          <div id="todo-scope-tabs">
            <button class="scope-tab active" data-scope="year">1ë…„ ê³„íš</button>
            <button class="scope-tab" data-scope="month">í•œ ë‹¬ ê³„íš</button>
            <button class="scope-tab" data-scope="week">ì¼ì£¼ì¼ ê³„íš</button>
            <button class="scope-tab" data-scope="day">í•˜ë£¨ ê³„íš</button>
          </div>

          <div class="input-row">
            <input type="text" id="todo-input" placeholder="ì´ ê¸°ê°„ ë™ì•ˆ í•´ì•¼ í•  ì¼ì„ ì ê³  Enter ë˜ëŠ” ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”." />
          </div>
          <div class="input-row goal-date-row">
            <div class="goal-date-group" id="todo-year-wrapper">
              <label for="todo-year">Year</label>
              <select id="todo-year"></select>
            </div>
            <div class="goal-date-group" id="todo-month-wrapper">
              <label for="todo-month">Month</label>
              <select id="todo-month"></select>
            </div>
            <div class="goal-date-group" id="todo-week-wrapper">
              <label for="todo-week">Week</label>
              <select id="todo-week">
                <option value="1">1ì£¼ì°¨</option>
                <option value="2">2ì£¼ì°¨</option>
                <option value="3">3ì£¼ì°¨</option>
                <option value="4">4ì£¼ì°¨</option>
                <option value="5">5ì£¼ì°¨</option>
              </select>
            </div>
            <div class="goal-date-group" id="todo-day-wrapper">
              <label for="todo-date-input">Date</label>
              <input type="date" id="todo-date-input" />
            </div>
            <button id="todo-add-btn" type="button">ì¶”ê°€</button>
          </div>

          <ul id="todo-list"></ul>

          <div class="hint">
            Â· â—‹: ì„±ê³µ / â–³: ì–´ëŠ ì •ë„ / âœ•: ëª» í•¨ / â–¡: ì•„ì§ í‰ê°€ ì „<br />
            Â· ë‚ ì§œë¥¼ ë„£ìœ¼ë©´ â€˜ë‹¬ë ¥â€™ íƒ­ì—ì„œ ë‚ ì§œë³„ë¡œ ê³„íšì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
          </div>
        </div>
      </section>

      <!-- CALENDAR -->
      <section id="calendar" class="section">
        <div class="card">
          <div class="card-header">
            <div class="card-title">ë‹¬ë ¥ìœ¼ë¡œ ë³´ê¸°</div>
            <span class="pill">ê³„íš ìº˜ë¦°ë”</span>
          </div>
          <div id="calendar-month-row">
            <button id="calendar-prev-btn" class="secondary">ì´ì „</button>
            <div id="calendar-month-center">
              <div id="calendar-month-label"></div>
              <input type="month" id="calendar-month-picker" />
            </div>
            <button id="calendar-next-btn" class="secondary">ë‹¤ìŒ</button>
          </div>
          <div id="calendar-grid"></div>
          <div id="calendar-selected-date">ì„ íƒí•œ ë‚ ì§œ: ì˜¤ëŠ˜</div>
          <div id="calendar-task-list"></div>

          <button id="calendar-add-todo-btn" class="secondary" style="margin-top:6px;">
            ì´ ë‚ ì§œì— ê³„íš ì¶”ê°€
          </button>

          <div class="hint">
            Â· ê³„íš ì¶”ê°€í•  ë•Œ ë‚ ì§œë¥¼ ë„£ìœ¼ë©´, í•´ë‹¹ ë‚ ì§œì— ì ì´ ì°íˆê³  ì•„ë˜ì— ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.<br />
            Â· ì—°/ì›”/ì£¼/ì¼ ì–´ë–¤ ë²”ì£¼ì— ë„£ì—ˆë“ , ë‚ ì§œê°€ ê°™ìœ¼ë©´ í•¨ê»˜ ëª¨ì•„ì„œ ë³´ì—¬ì¤˜ìš”.
          </div>
        </div>
      </section>

      <!-- POMODORO -->
      <section id="pomodoro" class="section">
        <div class="grid-two">
          <div class="card">
            <div class="card-header">
              <div class="card-title">í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸</div>
              <span class="pill">ì§‘ì¤‘/íœ´ì‹ ì‚¬ì´í´</span>
            </div>
            <div id="pomo-display">25:00</div>
            <div id="pomo-phase">ëŒ€ê¸° ì¤‘</div>
            <div id="pomo-controls">
              <button id="pomo-start-btn">ì‹œì‘</button>
              <button id="pomo-pause-btn" class="secondary">ì¼ì‹œ ì •ì§€</button>
              <button id="pomo-reset-btn" class="secondary">ë¦¬ì…‹</button>
            </div>
            <div id="pomo-progress-text">0 / 4 ì‚¬ì´í´</div>
            <div class="hint">
              ê¸°ë³¸ ì„¤ì •: 25ë¶„ ì§‘ì¤‘ â†’ 5ë¶„ íœ´ì‹ Ã— 4ì‚¬ì´í´ â†’ 10ë¶„ ê¸´ íœ´ì‹<br />
              ì§‘ì¤‘/ì‰¬ëŠ” ì‹œê°„, ì‚¬ì´í´ ìˆ˜ëŠ” ì˜¤ë¥¸ìª½ì—ì„œ ììœ ë¡­ê²Œ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">í¬ëª¨ë„ë¡œ ì„¤ì •</div>
              <span class="pill">ì‚¬ìš©ì ì„¤ì •</span>
            </div>
            <div id="pomo-config-grid">
              <div class="config-item">
                <label for="pomo-focus-min">ì§‘ì¤‘ ì‹œê°„(ë¶„)</label>
                <input type="number" id="pomo-focus-min" min="1" max="180" value="25" />
              </div>
              <div class="config-item">
                <label for="pomo-short-min">ì§§ì€ íœ´ì‹(ë¶„)</label>
                <input type="number" id="pomo-short-min" min="1" max="60" value="5" />
              </div>
              <div class="config-item">
                <label for="pomo-long-min">ê¸´ íœ´ì‹(ë¶„)</label>
                <input type="number" id="pomo-long-min" min="1" max="120" value="10" />
              </div>
              <div class="config-item">
                <label for="pomo-cycles">ê¸´ íœ´ì‹ ì „ ì‚¬ì´í´ ìˆ˜</label>
                <input type="number" id="pomo-cycles" min="1" max="12" value="4" />
              </div>
            </div>
            <button id="pomo-save-config-btn" style="margin-top:8px;">ì„¤ì • ì €ì¥</button>
            <div class="hint">
              * ì„¤ì •ì€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë¼ì„œ, ë‹¤ìŒì— ë“¤ì–´ì™€ë„ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </section>

      <!-- STUDY TIMER -->
      <section id="study" class="section">
        <div class="grid-two">
          <div class="card">
            <div class="card-header">
              <div class="card-title">ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„</div>
              <span class="pill">ì§‘ì¤‘ ê¸°ë¡</span>
            </div>
            <div id="study-time-today">00:00:00</div>
            <div id="study-status">ëŒ€ê¸° ì¤‘</div>
            <div id="study-controls">
              <button id="study-start-btn">ì‹œì‘</button>
              <button id="study-stop-btn" class="secondary">ì •ì§€</button>
              <button id="study-reset-btn" class="secondary">ì˜¤ëŠ˜ ê¸°ë¡ ì´ˆê¸°í™”</button>
              <button id="study-focus-btn" class="secondary">ì§‘ì¤‘ ëª¨ë“œ ì¼œê¸°</button>
            </div>
            <div id="study-log">
              Â· í˜„ì¬ ì„¸ì…˜ ì‹œê°„: <span id="study-session-time">00:00:00</span><br />
              Â· ìµœê·¼ ì„¸ì…˜ ê¸¸ì´: <span id="study-last-session">-</span>
            </div>
            <div class="hint">
              * â€œì‹œì‘â€ì„ ëˆ„ë¥´ë©´ ê³µë¶€ ì‹œê°„ ê¸°ë¡ì´ ì‹œì‘ë˜ê³ , â€œì •ì§€â€ë¥¼ ëˆ„ë¥´ë©´ ì˜¤ëŠ˜ ì´ ê³µë¶€ ì‹œê°„ì— ë”í•´ì§‘ë‹ˆë‹¤.<br />
              * ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œë§Œ í•©ì‚°ë˜ë©°, ë‚´ì¼ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ í•˜ë£¨ê°€ ì‹œì‘ë¼ìš”.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">ì§‘ì¤‘ ëª¨ë“œ ì•ˆë‚´</div>
              <span class="pill">ì§‘ì¤‘ í™”ë©´</span>
            </div>
            <p class="tagline">
              ì§„ì§œ ì•± ì°¨ë‹¨ê¹Œì§€ëŠ” ëª» í•˜ì§€ë§Œ,<br />
              ì´ ì›¹ì‚¬ì´íŠ¸ ì•ˆì—ì„œë§Œí¼ì€ â€œê³µë¶€ë§Œ í•˜ë„ë¡â€ ë•ëŠ” ëª¨ë“œì˜ˆìš”.
            </p>
            <ul style="margin-top:8px;font-size:0.82rem;color:var(--text-muted);line-height:1.5;">
              <li>Â· ì§‘ì¤‘ ëª¨ë“œë¥¼ ì¼œë©´ í™”ë©´ ì „ì²´ì— â€œì§‘ì¤‘ í™”ë©´â€ì´ ë– ìš”.</li>
              <li>Â· ê·¸ ìƒíƒœì—ì„œ ê·¸ëƒ¥ ë¬¸ì œë§Œ í’€ê³ , ë”´ìƒê°ì„ ì¤„ì´ëŠ” ìš©ë„!</li>
              <li>Â· í•„ìš”í•˜ë©´ ì–¸ì œë“  ëŒ ìˆ˜ ìˆì§€ë§Œ, ìŠ¤ìŠ¤ë¡œì™€ ì•½ì†í–ˆë‹¤ê³  ìƒê°í•´ ë³´ê¸°.</li>
              <li>Â· í¬ëª¨ë„ë¡œì™€ í•¨ê»˜ ì“°ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ê³µë¶€/íœ´ì‹ ë¦¬ë“¬ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="section">
        <div class="grid-two">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Google ê³„ì • & ë°ì´í„° ë°±ì—…</div>
              <span class="pill">Cloud Backup</span>
            </div>
            <p class="tagline">
              Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê³ , í˜„ì¬ ê¸°ê¸°ì˜ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œì— ë°±ì—…í•˜ê±°ë‚˜ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>

            <div id="google-status" class="hint" style="margin-top:8px;">
              ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>

            <div class="input-row" style="margin-top: 10px;">
              <button id="google-login-btn">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button>
              <button id="google-logout-btn" class="secondary">ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <hr style="margin:12px 0; border-color:rgba(148,163,184,0.4);" />

            <p class="tagline">
              ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì—…ë¡œë“œ ë˜ëŠ” ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>

            <div class="input-row" style="margin-top:10px;">
              <button id="cloud-backup-btn" class="secondary">í´ë¼ìš°ë“œì— ë°±ì—…</button>
              <button id="cloud-restore-btn" class="secondary">í´ë¼ìš°ë“œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>

            <div class="hint" style="margin-top:8px;">
              Â· ë°±ì—…: ì´ ë¸Œë¼ìš°ì €ì˜ ë°ì´í„°ë¥¼ í†µì§¸ë¡œ Firestoreì— ì €ì¥<br>
              Â· ë¶ˆëŸ¬ì˜¤ê¸°: Firestore ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ì´ ê¸°ê¸°ì— ë®ì–´ì“´ í›„ ìƒˆë¡œê³ ì¹¨
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">í…Œë§ˆ & í™”ë©´ ìœ ì§€</div>
              <span class="pill">Theme</span>
            </div>
            <p class="tagline">
              ë¼ì´íŠ¸/ë‹¤í¬ í…Œë§ˆë¥¼ ì „í™˜í•˜ê³ , ê°€ëŠ¥í•œ ë²”ìœ„ ì•ˆì—ì„œ í™”ë©´ì´ êº¼ì§€ì§€ ì•Šë„ë¡ ì‹œë„í•©ë‹ˆë‹¤.
            </p>
            <div class="hint" style="margin-top:6px;">
              Â· ìƒë‹¨ì˜ ë²„íŠ¼ìœ¼ë¡œ í…Œë§ˆë¥¼ ì „í™˜í•  ìˆ˜ ìˆì–´ìš”.<br />
              Â· íƒ€ì´ë¨¸(í¬ëª¨ë„ë¡œ/ê³µë¶€)ê°€ ëŒì•„ê°€ëŠ” ë™ì•ˆì—ëŠ” ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ í™”ë©´ êº¼ì§ì„ ë§‰ë„ë¡ ìš”ì²­í•´ìš”.<br />
              Â· iPad Safariì—ì„œëŠ” ì´ ê¸°ëŠ¥ì´ ì œí•œì ì¼ ìˆ˜ ìˆì–´ìš”.
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">ë°ì´í„° ì´ˆê¸°í™”</div>
              <span class="pill">Reset</span>
            </div>
            <p class="tagline">ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ëª¨ë“  ê¸°ë¡ì„ ì§€ìš°ê³  ì²˜ìŒ ìƒíƒœë¡œ ëŒë¦¬ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ì„¸ìš”.</p>
            <button id="reset-all-btn" class="danger" style="margin-top:10px;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
            <div class="hint">
              * D-Day, ëª©í‘œ, ëª¨ë“  To-do, ê³µë¶€ ì‹œê°„, í¬ëª¨ë„ë¡œ ì„¤ì • ë“±ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.<br />
              * ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë‹ˆ ì‹ ì¤‘í•˜ê²Œ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ===== ê³µí†µ: ë‚ ì§œ í¬ë§· =====
    function formatDate(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    // ===== ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ =====
    const todayLabel = document.getElementById("today-label");
    const today = new Date();
    const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
    todayLabel.textContent =
      `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")} (${dayNames[today.getDay()]})`;

    // ===== í…Œë§ˆ í† ê¸€ =====
    const themeToggleBtn = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const themeText = document.getElementById("theme-text");
    const THEME_KEY = "study_os_theme";

    function applyTheme(theme) {
      if (theme === "light") {
        document.body.classList.add("theme-light");
        themeIcon.textContent = "â˜€ï¸";
        themeText.textContent = "ë¼ì´íŠ¸ ëª¨ë“œ";
      } else {
        document.body.classList.remove("theme-light");
        themeIcon.textContent = "ğŸŒ™";
        themeText.textContent = "ë‹¤í¬ ëª¨ë“œ";
      }
      localStorage.setItem(THEME_KEY, theme);
    }

    const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
    applyTheme(savedTheme);

    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem(THEME_KEY) || "dark";
      applyTheme(current === "dark" ? "light" : "dark");
    });

    // ===== ë„¤ë¹„ê²Œì´ì…˜ =====
    const navButtons = document.querySelectorAll(".nav-btn");
    const sections = document.querySelectorAll(".section");
    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.section;
        navButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        sections.forEach((sec) => {
          sec.classList.toggle("active", sec.id === target);
        });
      });
    });

    // ===== D-DAY & ëª©í‘œ =====
    const DDAY_KEY = "study_os_dday";
    const GOALS_KEY = "study_os_goals";

    const ddayLabelEl = document.getElementById("dday-label");
    const ddayValueEl = document.getElementById("dday-value");
    const ddayTargetTextEl = document.getElementById("dday-target-text");
    const ddayTitleInput = document.getElementById("dday-title-input");
    const ddayDateInput = document.getElementById("dday-date-input");
    const ddaySaveBtn = document.getElementById("dday-save-btn");
    const ddayClearBtn = document.getElementById("dday-clear-btn");

    function renderDDay() {
      const saved = localStorage.getItem(DDAY_KEY);
      if (!saved) {
        ddayLabelEl.textContent = "ëª©í‘œ ë‚ ì§œì™€ ì œëª©ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”.";
        ddayValueEl.textContent = "D-0";
        ddayTargetTextEl.textContent = "";
        return;
      }
      const data = JSON.parse(saved);
      const targetDate = new Date(data.date);
      if (isNaN(targetDate.getTime())) {
        ddayLabelEl.textContent = "ëª©í‘œ ë‚ ì§œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì„¤ì •í•´ ì£¼ì„¸ìš”.";
        ddayValueEl.textContent = "D-0";
        ddayTargetTextEl.textContent = "";
        return;
      }
      const todayDateOnly = new Date(
        today.getFullYear(),
        today.getMonth(),
        today.getDate()
      );
      const targetDateOnly = new Date(
        targetDate.getFullYear(),
        targetDate.getMonth(),
        targetDate.getDate()
      );
      const diffMs = targetDateOnly - todayDateOnly;
      const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));
      let label = "";
      if (diffDays > 0) {
        label = `D-${diffDays}`;
      } else if (diffDays === 0) {
        label = "D-DAY";
      } else {
        label = `D+${Math.abs(diffDays)}`;
      }
      ddayLabelEl.textContent = data.title || "ëª©í‘œ";
      ddayValueEl.textContent = label;
      ddayTargetTextEl.textContent = `${data.date} ê¹Œì§€`;
      ddayTitleInput.value = data.title || "";
      ddayDateInput.value = data.date || "";
    }

    ddaySaveBtn.addEventListener("click", () => {
      const title = ddayTitleInput.value.trim();
      const dateStr = ddayDateInput.value;
      if (!title || !dateStr) {
        alert("ì œëª©ê³¼ ë‚ ì§œë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        return;
      }
      localStorage.setItem(DDAY_KEY, JSON.stringify({ title, date: dateStr }));
      renderDDay();
    });

    ddayClearBtn.addEventListener("click", () => {
      if (!confirm("D-Day ì„¤ì •ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
      localStorage.removeItem(DDAY_KEY);
      renderDDay();
    });

    renderDDay();

    // ----- Goals -----
    const goalInput = document.getElementById("goal-input");
    const goalAddBtn = document.getElementById("goal-add-btn");
    const goalsList = document.getElementById("goals-list");
    const goalsClearBtn = document.getElementById("goals-clear-btn");

    let goals = [];
    function loadGoals() {
      try {
        const saved = localStorage.getItem(GOALS_KEY);
        goals = saved ? JSON.parse(saved) : [];
      } catch {
        goals = [];
      }
    }
    function saveGoals() {
      localStorage.setItem(GOALS_KEY, JSON.stringify(goals));
    }
    function renderGoals() {
      goalsList.innerHTML = "";
      goals.forEach((g, idx) => {
        const li = document.createElement("li");
        li.className = "goal-item";
        const span = document.createElement("span");
        span.className = "goal-text";
        span.textContent = g;
        const btn = document.createElement("button");
        btn.className = "tiny";
        btn.textContent = "ì‚­ì œ";
        btn.addEventListener("click", () => {
          goals.splice(idx, 1);
          saveGoals();
          renderGoals();
        });
        li.appendChild(span);
        li.appendChild(btn);
        goalsList.appendChild(li);
      });
    }
    function addGoal() {
      const text = goalInput.value.trim();
      if (!text) return;
      goals.push(text);
      goalInput.value = "";
      saveGoals();
      renderGoals();
    }

    goalAddBtn.addEventListener("click", addGoal);
    goalInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addGoal();
    });
    goalsClearBtn.addEventListener("click", () => {
      if (!confirm("ì˜¤ëŠ˜ ëª©í‘œë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
      goals = [];
      saveGoals();
      renderGoals();
    });

    loadGoals();
    renderGoals();

    // ===== To-do (ì—°/ì›”/ì£¼/ì¼) + ë‚ ì§œ =====
    const TODOS_KEY = "study_os_todos_v1";
    const scopeTabs = document.querySelectorAll(".scope-tab");
    const todoInput = document.getElementById("todo-input");
    const todoDateInput = document.getElementById("todo-date-input");
    const todoAddBtn = document.getElementById("todo-add-btn");
    const todoListEl = document.getElementById("todo-list");
    const todoYearWrapper = document.getElementById("todo-year-wrapper");
    const todoMonthWrapper = document.getElementById("todo-month-wrapper");
    const todoWeekWrapper = document.getElementById("todo-week-wrapper");
    const todoDayWrapper = document.getElementById("todo-day-wrapper");
    const todoYearSelect = document.getElementById("todo-year");
    const todoMonthSelect = document.getElementById("todo-month");
    const todoWeekSelect = document.getElementById("todo-week");

    let todoData = {
      year: [],
      month: [],
      week: [],
      day: [],
    };
    let currentScope = "year";
    // ì—°/ì›”/ì£¼/ì¼ ì„ íƒ UI ì´ˆê¸°í™”
    const baseYear = today.getFullYear();
    for (let y = baseYear - 2; y <= baseYear + 5; y++) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      todoYearSelect.appendChild(opt);
    }

    for (let m = 1; m <= 12; m++) {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      todoMonthSelect.appendChild(opt);
    }

    todoYearSelect.value = String(baseYear);
    todoMonthSelect.value = String(today.getMonth() + 1);

    function updateTodoDateInputs() {
      if (currentScope === "year") {
        todoYearWrapper.style.display = "flex";
        todoMonthWrapper.style.display = "none";
        todoWeekWrapper.style.display = "none";
        todoDayWrapper.style.display = "none";
      } else if (currentScope === "month") {
        todoYearWrapper.style.display = "flex";
        todoMonthWrapper.style.display = "flex";
        todoWeekWrapper.style.display = "none";
        todoDayWrapper.style.display = "none";
      } else if (currentScope === "week") {
        todoYearWrapper.style.display = "flex";
        todoMonthWrapper.style.display = "flex";
        todoWeekWrapper.style.display = "flex";
        todoDayWrapper.style.display = "none";
      } else {
        // day
        todoYearWrapper.style.display = "none";
        todoMonthWrapper.style.display = "none";
        todoWeekWrapper.style.display = "none";
        todoDayWrapper.style.display = "flex";
        if (!todoDateInput.value) {
          todoDateInput.value = formatDate(today);
        }
      }
    }

    function loadTodos() {
      try {
        const saved = localStorage.getItem(TODOS_KEY);
        if (saved) {
          const parsed = JSON.parse(saved);
          todoData = Object.assign(todoData, parsed);
        }
      } catch {
        // ignore
      }
    }

    function saveTodos() {
      localStorage.setItem(TODOS_KEY, JSON.stringify(todoData));
      updateHomeSummary();
      renderCalendar(); // ìº˜ë¦°ë” ê°±ì‹ 
      renderCalendarSelectedTasks(selectedCalendarDateStr);
    }

    function cycleStatus(status) {
      if (status === "") return "success";
      if (status === "success") return "partial";
      if (status === "partial") return "fail";
      return "";
    }

    function getStatusSymbol(status) {
      if (status === "success") return "â—‹";
      if (status === "partial") return "â–³";
      if (status === "fail") return "âœ•";
      return "â–¡";
    }

    function scopeLabel(scope) {
      if (scope === "year") return "1ë…„ ê³„íš";
      if (scope === "month") return "í•œ ë‹¬ ê³„íš";
      if (scope === "week") return "ì¼ì£¼ì¼ ê³„íš";
      if (scope === "day") return "í•˜ë£¨ ê³„íš";
      return scope;
    }

    function formatTodoDateForScope(scope, dateStr) {
      if (!dateStr) return "";
      const parts = dateStr.split("-");
      if (parts.length < 3) return dateStr;
      const y = parts[0];
      const m = parseInt(parts[1], 10);
      const d = parseInt(parts[2], 10);
      if (scope === "year") {
        return `${y}ë…„`;
      }
      if (scope === "month") {
        return `${y}ë…„ ${m}ì›”`;
      }
      if (scope === "week") {
        const weekIndex = Math.floor((d - 1) / 7) + 1;
        return `${y}ë…„ ${m}ì›” ${weekIndex}ì£¼ì°¨`;
      }
      return dateStr;
    }

    function renderTodoList() {
      const list = todoData[currentScope] || [];
      todoListEl.innerHTML = "";
      list.forEach((item, idx) => {
        const li = document.createElement("li");
        li.className = "todo-item";

        const left = document.createElement("div");
        left.className = "todo-left";

        const statusBtn = document.createElement("button");
        statusBtn.className = "status-btn";
        statusBtn.textContent = getStatusSymbol(item.status || "");
        if (item.status === "success") statusBtn.classList.add("success");
        if (item.status === "partial") statusBtn.classList.add("partial");
        if (item.status === "fail") statusBtn.classList.add("fail");

        statusBtn.addEventListener("click", () => {
          const next = cycleStatus(item.status || "");
          item.status = next;
          saveTodos();
          renderTodoList();
        });

        const textWrap = document.createElement("div");
        const text = document.createElement("div");
        text.className = "todo-text";
        text.textContent = item.text;
        textWrap.appendChild(text);

        if (item.date) {
          const meta = document.createElement("div");
          meta.className = "todo-meta";
          const displayDate = formatTodoDateForScope(currentScope, item.date);
          meta.textContent = displayDate || item.date;
          textWrap.appendChild(meta);
        }

        left.appendChild(statusBtn);
        left.appendChild(textWrap);

        const actions = document.createElement("div");
        actions.className = "todo-actions";

        // ìˆ˜ì • ë²„íŠ¼
        const editBtn = document.createElement("button");
        editBtn.className = "tiny";
        editBtn.textContent = "ìˆ˜ì •";
        editBtn.addEventListener("click", () => {
            const newText = prompt("í•  ì¼ì„ìˆ˜ì •í•˜ì„¸ìš”", item.text);
            if (newText && newText.trim()) {
                item.text = newText.trim();
                saveTodos();
                renderTodoList();
            }
        });

        // ì‚­ì œ ë²„íŠ¼
        const delBtn = document.createElement("button");
        delBtn.className = "tiny";
        delBtn.textContent = "ì‚­ì œ";
        delBtn.addEventListener("click", () => {
          todoData[currentScope].splice(idx, 1);
          saveTodos();
          renderTodoList();
        });

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        li.appendChild(left);
        li.appendChild(actions);
        todoListEl.appendChild(li);
      });
    }

    function addTodo() {
      const text = todoInput.value.trim();
      if (!text) return;

      let dateStr = null;
      if (currentScope === "year") {
        const y = todoYearSelect.value;
        dateStr = `${y}-01-01`;
      } else if (currentScope === "month") {
        const y = todoYearSelect.value;
        const m = String(todoMonthSelect.value).padStart(2, "0");
        dateStr = `${y}-${m}-01`;
      } else if (currentScope === "week") {
        const y = parseInt(todoYearSelect.value, 10);
        const mIndex = parseInt(todoMonthSelect.value, 10) - 1;
        const w = parseInt(todoWeekSelect.value, 10);
        const baseDate = new Date(y, mIndex, 1 + (w - 1) * 7);
        dateStr = formatDate(baseDate);
      } else if (currentScope === "day") {
        dateStr = todoDateInput.value || null;
      }

      todoData[currentScope].push({ text, status: "", date: dateStr });
      todoInput.value = "";
      if (currentScope === "day") {
        todoDateInput.value = "";
      }

      saveTodos();
      renderTodoList();
    }

    scopeTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        scopeTabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");
        currentScope = tab.dataset.scope;
        updateTodoDateInputs();
        renderTodoList();
      });
    });

    todoAddBtn.addEventListener("click", addTodo);
    todoInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addTodo();
    });

    loadTodos();
    updateTodoDateInputs();
    renderTodoList();

    // ===== ìº˜ë¦°ë” =====
    const calendarGrid = document.getElementById("calendar-grid");
    const calendarMonthLabel = document.getElementById("calendar-month-label");
    const calendarPrevBtn = document.getElementById("calendar-prev-btn");
    const calendarNextBtn = document.getElementById("calendar-next-btn");
    const calendarSelectedDateEl = document.getElementById("calendar-selected-date");
    const calendarTaskList = document.getElementById("calendar-task-list");
    const calendarAddTodoBtn = document.getElementById("calendar-add-todo-btn");
    // ì„ íƒí•œ ë‚ ì§œì— ê³„íš ì¶”ê°€ ë²„íŠ¼
    if (calendarAddTodoBtn) {
        calendarAddTodoBtn.addEventListener("click", () => {
            // 1) To-do ì„¹ì…˜ìœ¼ë¡œ ì´ë™
            const todosNavBtn = document.querySelector('.nav-btn[data-section="todos"]');
            if (todosNavBtn) {
                todosNavBtn.click();
            }
            // 2) ìŠ¤ì½”í”„ë¥¼ "í•˜ë£¨ ê³„íšìœ¼ë¡œ ë³€ê²½"
            currentScope = "day";
            scopeTabs.forEach((tab) => {
                tab.classList.toggle("active", tab.dataset.scope === "day");
            });
            // 3) ë‚ ì§œ ì¸í’‹ì— ìº˜ë¦°ë”ì—ì„œ ì„ íƒí•œ ë‚ ì§œ ì±„ì›Œ ë„£ê¸°
            if (todoDateInput) {
                todoDateInput.value = selectedCalendarDateStr;
                todoDateInput.focus();
            }
            // 4) To-do ë¦¬ìŠ¤íŠ¸ë¥¼ í˜„ì¬ ìŠ¤ì½”í”„ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ë Œë”
            if (typeof updateTodoDateInputs === "function") {
                updateTodoDateInputs();
            }
            renderTodoList();
        });
    }

    const calendarMonthPicker = document.getElementById("calendar-month-picker");
    let calendarCurrent = new Date(today.getFullYear(), today.getMonth(), 1);
    let selectedCalendarDateStr = formatDate(today);

    function getTodosByDate(dateStr) {
      const result = [];
      ["year", "month", "week", "day"].forEach((scope) => {
        (todoData[scope] || []).forEach((item) => {
          if (item.date === dateStr) {
            result.push({ ...item, scope });
          }
        });
      });
      return result;
    }

    function renderCalendar() {
      const year = calendarCurrent.getFullYear();
      const month = calendarCurrent.getMonth(); // 0-11
      calendarMonthLabel.textContent = `${year}ë…„ ${month + 1}ì›”`;

      if (calendarMonthPicker) {
        const monthValue = `${year}-${String(month + 1).padStart(2, "0")}`;
        if (calendarMonthPicker.value !== monthValue) {
          calendarMonthPicker.value = monthValue;
        }
      }

      calendarGrid.innerHTML = "";

      const weekdays = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
      weekdays.forEach((wd) => {
        const div = document.createElement("div");
        div.className = "calendar-weekday";
        div.textContent = wd;
        calendarGrid.appendChild(div);
      });

      const firstDay = new Date(year, month, 1);
      const startDayOfWeek = firstDay.getDay(); // 0-6

      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const prevMonthDays = new Date(year, month, 0).getDate();

      const totalCells = 42; // 6ì£¼ * 7ì¼
      const todayStr = formatDate(today);

      for (let i = 0; i < totalCells; i++) {
        const cellIndex = i - startDayOfWeek + 1;
        let cellDate, inCurrentMonth = true;

        if (cellIndex <= 0) {
          cellDate = new Date(year, month - 1, prevMonthDays + cellIndex);
          inCurrentMonth = false;
        } else if (cellIndex > daysInMonth) {
          cellDate = new Date(year, month + 1, cellIndex - daysInMonth);
          inCurrentMonth = false;
        } else {
          cellDate = new Date(year, month, cellIndex);
        }

        const dateStr = formatDate(cellDate);
        const dayDiv = document.createElement("div");
        dayDiv.className = "calendar-day";
        if (!inCurrentMonth) {
          dayDiv.classList.add("other-month");
        }
        if (dateStr === selectedCalendarDateStr) {
          dayDiv.classList.add("selected");
        }

        const numDiv = document.createElement("div");
        numDiv.className = "calendar-day-number";
        numDiv.textContent = cellDate.getDate();

        dayDiv.appendChild(numDiv);

        const todosForDay = getTodosByDate(dateStr);
        if (todosForDay.length > 0) {
          const dot = document.createElement("div");
          dot.className = "calendar-day-dot";
          dayDiv.appendChild(dot);
        } else {
          const spacer = document.createElement("div");
          spacer.style.height = "6px";
          dayDiv.appendChild(spacer);
        }

        if (dateStr === todayStr) {
          dayDiv.style.boxShadow = "0 0 0 1px rgba(148,163,184,0.5)";
        }

        dayDiv.addEventListener("click", () => {
          selectedCalendarDateStr = dateStr;
          renderCalendar();
          renderCalendarSelectedTasks(selectedCalendarDateStr);
        });

        calendarGrid.appendChild(dayDiv);
      }
    }

    function renderCalendarSelectedTasks(dateStr) {
      calendarSelectedDateEl.textContent = `ì„ íƒí•œ ë‚ ì§œ: ${dateStr}`;
      const todosForDay = getTodosByDate(dateStr);
      calendarTaskList.innerHTML = "";
      if (todosForDay.length === 0) {
        const p = document.createElement("div");
        p.textContent = "ì´ ë‚ ì§œì—ëŠ” ë“±ë¡ëœ ê³„íšì´ ì—†ìŠµë‹ˆë‹¤.";
        p.style.color = "var(--text-muted)";
        p.style.fontSize = "0.8rem";
        calendarTaskList.appendChild(p);
        return;
      }
      todosForDay.forEach((item) => {
        const div = document.createElement("div");
        div.className = "calendar-task-item";
        const main = document.createElement("div");
        main.textContent = `${getStatusSymbol(item.status || "")} ${item.text}`;
        const scopeInfo = document.createElement("div");
        scopeInfo.className = "calendar-task-scope";
        scopeInfo.textContent = scopeLabel(item.scope);
        div.appendChild(main);
        div.appendChild(scopeInfo);
        calendarTaskList.appendChild(div);
      });
    }

    calendarPrevBtn.addEventListener("click", () => {
      calendarCurrent = new Date(
        calendarCurrent.getFullYear(),
        calendarCurrent.getMonth() - 1,
        1
      );
      renderCalendar();
      renderCalendarSelectedTasks(selectedCalendarDateStr);
    });

    calendarNextBtn.addEventListener("click", () => {
      calendarCurrent = new Date(
        calendarCurrent.getFullYear(),
        calendarCurrent.getMonth() + 1,
        1
      );
      renderCalendar();
      renderCalendarSelectedTasks(selectedCalendarDateStr);
    });

    if (calendarMonthPicker) {
      calendarMonthPicker.addEventListener("change", (e) => {
        if (!e.target.value) return;
        const [y, m] = e.target.value.split("-");
        calendarCurrent = new Date(Number(y), Number(m) - 1, 1);
        renderCalendar();
        renderCalendarSelectedTasks(selectedCalendarDateStr);
      });
    }

    renderCalendar();
    renderCalendarSelectedTasks(selectedCalendarDateStr);

    // ===== í¬ëª¨ë„ë¡œ =====
    const POMO_CONFIG_KEY = "study_os_pomo_config_v1";

    const pomoDisplay = document.getElementById("pomo-display");
    const pomoPhaseEl = document.getElementById("pomo-phase");
    const pomoProgressText = document.getElementById("pomo-progress-text");
    const pomoStartBtn = document.getElementById("pomo-start-btn");
    const pomoPauseBtn = document.getElementById("pomo-pause-btn");
    const pomoResetBtn = document.getElementById("pomo-reset-btn");

    const pomoFocusMinInput = document.getElementById("pomo-focus-min");
    const pomoShortMinInput = document.getElementById("pomo-short-min");
    const pomoLongMinInput = document.getElementById("pomo-long-min");
    const pomoCyclesInput = document.getElementById("pomo-cycles");
    const pomoSaveConfigBtn = document.getElementById("pomo-save-config-btn");

    let pomoConfig = {
      focus: 25,
      shortBreak: 5,
      longBreak: 10,
      cyclesBeforeLong: 4,
    };

    function loadPomoConfig() {
      try {
        const saved = localStorage.getItem(POMO_CONFIG_KEY);
        if (saved) {
          const parsed = JSON.parse(saved);
          pomoConfig = Object.assign(pomoConfig, parsed);
        }
      } catch {
        // ignore
      }
      pomoFocusMinInput.value = pomoConfig.focus;
      pomoShortMinInput.value = pomoConfig.shortBreak;
      pomoLongMinInput.value = pomoConfig.longBreak;
      pomoCyclesInput.value = pomoConfig.cyclesBeforeLong;
    }

    function savePomoConfig() {
      pomoConfig.focus = Math.max(
        1,
        parseInt(pomoFocusMinInput.value || "25", 10)
      );
      pomoConfig.shortBreak = Math.max(
        1,
        parseInt(pomoShortMinInput.value || "5", 10)
      );
      pomoConfig.longBreak = Math.max(
        1,
        parseInt(pomoLongMinInput.value || "10", 10)
      );
      pomoConfig.cyclesBeforeLong = Math.max(
        1,
        parseInt(pomoCyclesInput.value || "4", 10)
      );
      localStorage.setItem(POMO_CONFIG_KEY, JSON.stringify(pomoConfig));
      if (!pomoRunning) {
        pomoSecondsLeft = pomoConfig.focus * 60;
        updatePomoDisplay();
      }
    }

    pomoSaveConfigBtn.addEventListener("click", () => {
      savePomoConfig();
      alert("í¬ëª¨ë„ë¡œ ì„¤ì •ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.");
    });

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    let pomoMode = "idle"; // idle | focus | short | long
    let pomoCycleCount = 0;
    let pomoSecondsLeft = pomoConfig.focus * 60;
    let pomoIntervalId = null;
    let pomoRunning = false;

    function updatePomoDisplay() {
      pomoDisplay.textContent = formatTime(pomoSecondsLeft);
      let phaseText = "";
      if (pomoMode === "focus") phaseText = "ì§‘ì¤‘ ì‹œê°„";
      else if (pomoMode === "short") phaseText = "ì§§ì€ íœ´ì‹";
      else if (pomoMode === "long") phaseText = "ê¸´ íœ´ì‹";
      else phaseText = "ëŒ€ê¸° ì¤‘";
      pomoPhaseEl.textContent = phaseText;
      pomoProgressText.textContent = `${pomoCycleCount} / ${pomoConfig.cyclesBeforeLong} ì‚¬ì´í´`;
    }

    function startPomoTicking() {
      if (pomoIntervalId !== null) return;
      pomoRunning = true;
      requestWakeLock(); // í™”ë©´ ìœ ì§€ ì‹œë„
      pomoIntervalId = setInterval(() => {
        pomoSecondsLeft--;
        if (pomoSecondsLeft <= 0) {
          handlePomoPhaseEnd();
        }
        updatePomoDisplay();
      }, 1000);
    }

    function stopPomoTicking() {
      if (pomoIntervalId !== null) {
        clearInterval(pomoIntervalId);
        pomoIntervalId = null;
      }
      pomoRunning = false;
      releaseWakeLockIfNeeded();
    }

    function handlePomoPhaseEnd() {
      if (pomoMode === "focus") {
        if (pomoCycleCount >= pomoConfig.cyclesBeforeLong) {
          pomoMode = "long";
          pomoSecondsLeft = pomoConfig.longBreak * 60;
          alert("ì§‘ì¤‘ ì„¸íŠ¸ ì™„ë£Œ! ê¸´ íœ´ì‹ì„ ê°€ì ¸ë³´ì„¸ìš”.");
        } else {
          pomoMode = "short";
          pomoSecondsLeft = pomoConfig.shortBreak * 60;
          alert("ì§‘ì¤‘ ë! ì§§ì€ íœ´ì‹ì„ ê°€ì ¸ë³´ì„¸ìš”.");
        }
      } else if (pomoMode === "short") {
        pomoCycleCount++;
        if (pomoCycleCount >= pomoConfig.cyclesBeforeLong) {
          pomoMode = "long";
          pomoSecondsLeft = pomoConfig.longBreak * 60;
          alert("ì—¬ëŸ¬ ë²ˆì˜ ì§‘ì¤‘ì„ ë§ˆì³¤ì–´ìš”. ê¸´ íœ´ì‹ì„ ê°€ì ¸ë³´ì„¸ìš”!");
        } else {
          pomoMode = "focus";
          pomoSecondsLeft = pomoConfig.focus * 60;
          alert("íœ´ì‹ ë! ë‹¤ì‹œ ì§‘ì¤‘ ì‹œì‘!");
        }
      } else if (pomoMode === "long") {
        alert("ê¸´ íœ´ì‹ê¹Œì§€ ëª¨ë‘ ëë‚¬ì–´ìš”. ìˆ˜ê³ í–ˆì–´ìš”! ë‹¤ì‹œ ì‹œì‘í• ì§€ ê²°ì •í•´ ë³´ì„¸ìš”.");
        pomoMode = "idle";
        pomoCycleCount = 0;
        pomoSecondsLeft = pomoConfig.focus * 60;
        stopPomoTicking();
      }
      updatePomoDisplay();
    }

    pomoStartBtn.addEventListener("click", () => {
      if (pomoMode === "idle") {
        pomoMode = "focus";
        pomoCycleCount = 0;
        pomoSecondsLeft = pomoConfig.focus * 60;
        updatePomoDisplay();
      }
      startPomoTicking();
    });

    pomoPauseBtn.addEventListener("click", () => {
      if (!pomoRunning) return;
      stopPomoTicking();
      pomoPhaseEl.textContent += " (ì¼ì‹œ ì •ì§€)";
    });

    pomoResetBtn.addEventListener("click", () => {
      if (!confirm("í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸ë¥¼ ë¦¬ì…‹í• ê¹Œìš”?")) return;
      stopPomoTicking();
      pomoMode = "idle";
      pomoCycleCount = 0;
      pomoSecondsLeft = pomoConfig.focus * 60;
      updatePomoDisplay();
    });

    loadPomoConfig();
    pomoSecondsLeft = pomoConfig.focus * 60;
    updatePomoDisplay();

    // ===== ê³µë¶€ íƒ€ì´ë¨¸ (ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„) =====
    const STUDY_KEY = "study_os_study_log_v1";
    const STUDY_SESSION_KEY = "study_os_current_session";

    const studyTimeTodayEl = document.getElementById("study-time-today");
    const studyStatusEl = document.getElementById("study-status");
    const studyStartBtn = document.getElementById("study-start-btn");
    const studyStopBtn = document.getElementById("study-stop-btn");
    const studyResetBtn = document.getElementById("study-reset-btn");
    const studyFocusBtn = document.getElementById("study-focus-btn");
    const studySessionTimeEl = document.getElementById("study-session-time");
    const studyLastSessionEl = document.getElementById("study-last-session");

    let studyLog = {}; // { "YYYY-MM-DD": seconds }
    let studyRunning = false;
    let studySessionStart = null;
    let studySessionTimerId = null;
    let studyLastSessionSeconds = null;

    function loadStudyLog() {
      try {
        const saved = localStorage.getItem(STUDY_KEY);
        studyLog = saved ? JSON.parse(saved) : {};
      } catch {
        studyLog = {};
      }
      try {
        const savedSession = localStorage.getItem(STUDY_SESSION_KEY);
        if (savedSession) {
          const obj = JSON.parse(savedSession);
          if (obj.running && obj.startTime) {
            studySessionStart = new Date(obj.startTime);
            studyRunning = true;
            startStudySessionTicking();
            studyStatusEl.textContent = "ê³µë¶€ ì¤‘ (ì´ì „ì— ì‹œì‘ë¨)";
            requestWakeLock();
          }
        }
      } catch {
        // ignore
      }
    }

    function saveStudyLog() {
      localStorage.setItem(STUDY_KEY, JSON.stringify(studyLog));
      updateStudyDisplay();
      updateHomeSummary();
    }

    function saveStudySessionState() {
      localStorage.setItem(
        STUDY_SESSION_KEY,
        JSON.stringify({
          running: studyRunning,
          startTime: studySessionStart ? studySessionStart.toISOString() : null,
        })
      );
    }

    function formatHMS(sec) {
      const h = Math.floor(sec / 3600);
      const m = Math.floor((sec % 3600) / 60);
      const s = sec % 60;
      return (
        String(h).padStart(2, "0") +
        ":" +
        String(m).padStart(2, "0") +
        ":" +
        String(s).padStart(2, "0")
      );
    }

    function getTodaySeconds() {
      const key = formatDate(today);
      return studyLog[key] || 0;
    }

    function updateStudyDisplay() {
      const total = getTodaySeconds();
      studyTimeTodayEl.textContent = formatHMS(total);
      if (studyLastSessionSeconds != null) {
        studyLastSessionEl.textContent = formatHMS(studyLastSessionSeconds);
      }
    }

    function updateStudySessionTime() {
      if (!studySessionStart) {
        studySessionTimeEl.textContent = "00:00:00";
        return;
      }
      const diffSec = Math.max(
        0,
        Math.floor((Date.now() - studySessionStart.getTime()) / 1000)
      );
      studySessionTimeEl.textContent = formatHMS(diffSec);
    }

    function startStudySessionTicking() {
      if (studySessionTimerId !== null) return;
      studySessionTimerId = setInterval(updateStudySessionTime, 1000);
      requestWakeLock();
    }

    function stopStudySessionTicking() {
      if (studySessionTimerId !== null) {
        clearInterval(studySessionTimerId);
        studySessionTimerId = null;
      }
      releaseWakeLockIfNeeded();
    }

    studyStartBtn.addEventListener("click", () => {
      if (studyRunning) return;
      studyRunning = true;
      studySessionStart = new Date();
      studyStatusEl.textContent = "ê³µë¶€ ì¤‘";
      saveStudySessionState();
      startStudySessionTicking();
    });

    studyStopBtn.addEventListener("click", () => {
      if (!studyRunning || !studySessionStart) return;
      const now = new Date();
      const diffSec = Math.max(
        0,
        Math.floor((now.getTime() - studySessionStart.getTime()) / 1000)
      );
      studyLastSessionSeconds = diffSec;
      const key = formatDate(today);
      studyLog[key] = (studyLog[key] || 0) + diffSec;
      studyRunning = false;
      studySessionStart = null;
      studyStatusEl.textContent = "ëŒ€ê¸° ì¤‘";
      stopStudySessionTicking();
      saveStudySessionState();
      saveStudyLog();
      updateStudySessionTime();
    });

    studyResetBtn.addEventListener("click", () => {
      if (!confirm("ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„ì„ 0ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
      const key = formatDate(today);
      studyLog[key] = 0;
      studyLastSessionSeconds = null;
      studyRunning = false;
      studySessionStart = null;
      stopStudySessionTicking();
      saveStudySessionState();
      saveStudyLog();
      studyStatusEl.textContent = "ëŒ€ê¸° ì¤‘";
      studySessionTimeEl.textContent = "00:00:00";
      studyLastSessionEl.textContent = "-";
    });

    studyFocusBtn.addEventListener("click", () => {
      openFocusOverlay();
    });

    loadStudyLog();
    updateStudyDisplay();
    updateStudySessionTime();

    // ===== ì§‘ì¤‘ ëª¨ë“œ(ì†Œí”„íŠ¸ ë¸”ë¡) =====
    const focusOverlay = document.getElementById("focus-overlay");
    const focusExitBtn = document.getElementById("focus-exit-btn");
    const focusTimerLabel = document.getElementById("focus-timer-label");

    let focusIntervalId = null;
    let focusStartTime = null;

    function openFocusOverlay() {
      focusOverlay.style.display = "flex";
      focusStartTime = new Date();
      updateFocusTimer();
      if (focusIntervalId !== null) clearInterval(focusIntervalId);
      focusIntervalId = setInterval(updateFocusTimer, 1000);
    }

    function closeFocusOverlay() {
      focusOverlay.style.display = "none";
      if (focusIntervalId !== null) {
        clearInterval(focusIntervalId);
        focusIntervalId = null;
      }
    }

    function updateFocusTimer() {
      if (!focusStartTime) {
        focusTimerLabel.textContent = "--:--";
        return;
      }
      const diffSec = Math.floor(
        (Date.now() - focusStartTime.getTime()) / 1000
      );
      const m = Math.floor(diffSec / 60);
      const s = diffSec % 60;
      focusTimerLabel.textContent =
        String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    focusExitBtn.addEventListener("click", () => {
      closeFocusOverlay();
    });

    // ===== Wake Lock (ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì €ì—ì„œ í™”ë©´ ìœ ì§€ ì‹œë„) =====
    let wakeLock = null;
    let wakeLockRequested = false;

    async function requestWakeLock() {
      if (!("wakeLock" in navigator)) return;
      if (wakeLockRequested) return;
      try {
        wakeLockRequested = true;
        wakeLock = await navigator.wakeLock.request("screen");
        wakeLock.addEventListener("release", () => {
          wakeLockRequested = false;
        });
      } catch (e) {
        wakeLockRequested = false;
      }
    }

    function releaseWakeLockIfNeeded() {
      const anyTimerRunning = pomoRunning || studyRunning;
      if (!anyTimerRunning && wakeLock) {
        wakeLock.release();
        wakeLock = null;
        wakeLockRequested = false;
      }
    }

    // ===== í™ˆ ìš”ì•½ ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ ê³µë¶€ ì‹œê°„ + ì™„ë£Œ To-do ê°œìˆ˜) =====
    const summaryStudyTimeEl = document.getElementById("summary-study-time");
    const summaryDoneCountEl = document.getElementById("summary-done-count");

    function countAllDoneTodos() {
      let count = 0;
      ["year", "month", "week", "day"].forEach((scope) => {
        (todoData[scope] || []).forEach((item) => {
          if (item.status === "success") count++;
        });
      });
      return count;
    }

    function updateHomeSummary() {
      summaryStudyTimeEl.textContent = formatHMS(getTodaySeconds());
      summaryDoneCountEl.textContent = String(countAllDoneTodos());
    }

    updateHomeSummary();

    // ===== ì „ì²´ ì´ˆê¸° ë¡œë”© í›„ ìº˜ë¦°ë”ì™€ ìš”ì•½ ë°˜ì˜ =====
    renderCalendar();
    renderCalendarSelectedTasks(selectedCalendarDateStr);

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("/My-Study-OS/service-worker.js")
          .catch((err) => console.error("SW ë“±ë¡ ì‹¤íŒ¨:", err))
      });
    }

  </script>
  <script type="module">
  /* Firebase SDK import */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyC-OtOZzkLk1f70wWegmv2zDcCJqlFZlLA",
    authDomain: "my-study-os-3758c.firebaseapp.com",
    projectId: "my-study-os-3758c",
    storageBucket: "my-study-os-3758c.firebasestorage.app",
    messagingSenderId: "632448831360",
    appId: "1:632448831360:web:bd8f776773cdfc72f93b65",
    measurementId: "G-VD3P1XY2E7"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  /* DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° */
  const loginBtn   = document.getElementById("google-login-btn");
  const logoutBtn  = document.getElementById("google-logout-btn");
  const statusEl   = document.getElementById("google-status");
  const backupBtn  = document.getElementById("cloud-backup-btn");
  const restoreBtn = document.getElementById("cloud-restore-btn");

  /* localStorage ë°±ì—…í•  key ëª©ë¡ */
  const LOCAL_KEYS = [
    "study_os_dday",
    "study_os_goals",
    "study_os_todos_v1",
    "study_os_pomo_config_v1",
    "study_os_study_log_v1",
    "study_os_current_session",
    "study_os_theme"
  ];

  function getLocalData() {
    const data = {};
    LOCAL_KEYS.forEach(key => {
      const val = localStorage.getItem(key);
      if (val !== null) data[key] = val;
    });
    return data;
  }

  async function saveCloud(user) {
    const data = getLocalData();
    const ref = doc(db, "users", user.uid);
    await setDoc(ref, data, { merge: true });
    alert("í´ë¼ìš°ë“œ ë°±ì—… ì™„ë£Œ!");
  }

  async function loadCloud(user) {
    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists()) {
      alert("í´ë¼ìš°ë“œì— ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    const data = snap.data();
    Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
    alert("ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
    location.reload();
  }

  loginBtn.addEventListener("click", async () => {
    try {
      await signInWithPopup(auth, provider);
    } catch (e) {
      console.error(e);
      alert("ë¡œê·¸ì¸ ì˜¤ë¥˜ ë°œìƒ");
    }
  });

  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
  });

  backupBtn.addEventListener("click", () => {
    const user = auth.currentUser;
    if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
    saveCloud(user);
  });

  restoreBtn.addEventListener("click", () => {
    const user = auth.currentUser;
    if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
    if (!confirm("í´ë¼ìš°ë“œ ë°ì´í„°ë¥¼ í˜„ì¬ ê¸°ê¸° ë°ì´í„°ì— ë®ì–´ì”ë‹ˆë‹¤. ê³„ì†í• ê¹Œìš”?")) return;
    loadCloud(user);
  });

  /* ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ê°ì§€ */
  onAuthStateChanged(auth, user => {
    if (user) {
      statusEl.textContent = `ë¡œê·¸ì¸ë¨: ${user.displayName || user.email}`;
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-flex";
      backupBtn.disabled = false;
      restoreBtn.disabled = false;
    } else {
      statusEl.textContent = "ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.";
      loginBtn.style.display = "inline-flex";
      logoutBtn.style.display = "none";
      backupBtn.disabled = true;
      restoreBtn.disabled = true;
    }
  });

  /* ì´ˆê¸° ìƒíƒœ */
  logoutBtn.style.display = "none";
  backupBtn.disabled = true;
  restoreBtn.disabled = true;
</script>

</body>
</html>
